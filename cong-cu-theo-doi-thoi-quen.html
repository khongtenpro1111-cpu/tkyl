<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Theo Dõi Thói Quen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== CÁC BIẾN VÀ THIẾT LẬP CHUNG ==================== */
        :root {
            --bg-color: #12121e;
            --main-color: #f72585; /* Hồng neon */
            --accent-color: #4361ee; /* Xanh dương */
            --card-bg: #1e1e2d;
            --border-color: #2b2b3b;
            --text-color: #f0f0f0;
            --secondary-text-color: #a0a0a0;
            --button-success: #52b788;
            --button-danger: #e63964;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            padding-bottom: 60px;
            transition: color 0.3s ease, background-color 0.3s ease;
        }

        h1, h2, h3, h4 {
            font-family: 'Poppins', sans-serif;
            color: var(--main-color);
            text-align: center;
            font-weight: 600;
        }
        
        /* ==================== HEADER & FOOTER ==================== */
        header.header-container {
            background-color: var(--card-bg);
            padding: 40px 20px 20px;
            text-align: center;
            border-bottom: 3px solid var(--accent-color);
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease, border-bottom 0.3s ease;
        }

        header.header-container h1 {
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            animation: none;
            transition: color 0.3s ease;
        }
        
        footer {
            background-color: var(--card-bg);
            text-align: center;
            padding: 20px;
            color: var(--secondary-text-color);
            border-top: 2px solid var(--accent-color);
            transition: background-color 0.3s ease, border-top 0.3s ease;
        }

        /* ==================== GIAO DIỆN CHÍNH CỦA CÔNG CỤ ==================== */
        .habit-tracker-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 40px;
            text-align: center;
            background-color: var(--card-bg);
            border-radius: 15px;
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--main-color), var(--accent-color)) 1;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .habit-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .habit-controls input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .start-btn, .reset-btn, .select-habit-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background-color: var(--accent-color);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .reset-btn {
            background-color: var(--button-danger);
        }

        .start-btn:hover, .select-habit-btn:hover {
            background-color: var(--main-color);
        }

        .reset-btn:hover {
            background-color: #c92f59;
        }
        
        .habit-display {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--accent-color);
            margin-top: 20px;
            transition: color 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .share-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 1.2em;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .share-btn:hover {
            color: var(--main-color);
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .calendar-nav button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .calendar-nav button:hover {
            color: var(--main-color);
        }

        .calendar-nav h3 {
            margin: 0;
            color: var(--main-color);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }

        .calendar-header {
            font-weight: 700;
            color: var(--main-color);
            text-align: center;
            padding: 10px 0;
            transition: color 0.3s ease;
        }

        .day-cell {
            padding: 15px 5px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 50px;
        }
        
        .day-cell.clickable {
            cursor: pointer;
        }

        .day-cell.clickable:hover {
            background-color: #1a1a25;
        }

        .day-cell.completed {
            background-color: var(--button-success);
            color: white;
            box-shadow: 0 0 10px var(--button-success);
        }

        .day-cell.current-day {
            border: 2px solid var(--main-color);
        }

        .day-cell.has-note .note-icon {
            display: block;
            color: var(--main-color);
        }
        
        .note-icon {
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.8em;
            cursor: pointer;
            color: var(--secondary-text-color);
            display: none;
        }
        
        .day-cell.clickable:hover .note-icon {
            display: block;
        }
        
        .habit-list-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .statistics {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background-color: #1a1a25;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .statistics-item {
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        .statistics-item span {
            display: block;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--main-color);
        }
        
        .notification {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 0 0 10px 10px;
            color: var(--text-color);
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: top 0.5s ease-in-out;
            text-align: center;
        }

        .notification.success {
            background-color: var(--button-success);
        }

        .notification.error {
            background-color: var(--button-danger);
        }
        
        .notification.show {
            top: 0;
        }

        .data-management-btns {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .data-management-btns button {
            background-color: #1a1a25;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .data-management-btns button:hover {
            background-color: var(--main-color);
        }
        
        .note-modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none;
        }

        .note-modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--main-color);
            animation: fadeIn 0.5s ease-out;
        }

        .note-modal-content h3 {
            margin-top: 0;
        }

        .note-modal-content textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1em;
            box-sizing: border-box;
            resize: none;
        }

        .note-modal-content button {
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .note-modal-content #save-note-btn {
            background-color: var(--button-success);
            color: white;
        }

        .note-modal-content #close-note-btn {
            background-color: var(--button-danger);
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .chart-container {
            width: 100%;
            height: 150px;
            margin-top: 20px;
            border-radius: 10px;
            background-color: #1a1a25;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: flex-end;
            gap: 2px;
            padding: 5px;
        }
        
        .chart-bar {
            flex: 1;
            background-color: var(--accent-color);
            transition: height 0.3s ease;
            border-radius: 3px 3px 0 0;
            display: flex;
            justify-content: center;
            position: relative;
        }
        
        .chart-bar::after {
            content: attr(data-day);
            position: absolute;
            bottom: -20px;
            font-size: 0.8em;
            color: var(--secondary-text-color);
        }

        .goal-container {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: #1a1a25;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .goal-input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .goal-input-group input {
            flex: 1;
        }

        .goal-status {
            font-weight: 600;
            color: var(--accent-color);
        }

        .goal-status.achieved {
            color: var(--button-success);
        }

        .reminder-container {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: #1a1a25;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .reminder-input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        .reminder-input-group input[type="time"] {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1em;
        }
        
        .reminder-input-group button {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background-color: var(--accent-color);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
        }
        
        .template-modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none;
        }
        
        .template-modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--main-color);
            animation: fadeIn 0.5s ease-out;
        }
        
        .template-list {
            list-style: none;
            padding: 0;
        }

        .template-item {
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .template-item:hover {
            background-color: #1a1a25;
            color: var(--main-color);
        }

        .theme-button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .theme-swatch {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        }

        .theme-swatch.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            color: #fff;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .theme-swatch:hover {
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .calendar-settings-modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none;
        }

        .calendar-settings-modal-content {
            background-color: var(--card-bg);
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--main-color);
            animation: fadeIn 0.5s ease-out;
            text-align: center;
        }

        .calendar-settings-modal-content h3 {
            margin-top: 0;
        }

        .calendar-settings-modal-content .day-options-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .day-option {
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .day-option.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        .day-option:hover {
            background-color: #1a1a25;
        }
        
        .history-modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none;
        }

        .history-modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--main-color);
            animation: fadeIn 0.5s ease-out;
            text-align: left;
        }
        
        .history-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .history-item {
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: relative;
        }
        
        .history-item:hover {
            background-color: #1a1a25;
            color: var(--main-color);
        }

        .history-item h4 {
            text-align: left;
            margin: 0 0 5px 0;
        }

        .history-item p {
            margin: 0;
            font-size: 0.9em;
            color: var(--secondary-text-color);
        }
        
        .history-item .load-btn {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .history-item .load-btn:hover {
            background-color: var(--main-color);
        }

        /* ==================== MEDIA QUERIES (RESPONSIVE) ==================== */
        @media (max-width: 768px) {
            .habit-tracker-container {
                padding: 20px;
            }
            .habit-controls {
                flex-direction: column;
            }
            .statistics {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="notification-bar" class="notification"></div>
    <div id="note-modal" class="note-modal">
        <div class="note-modal-content">
            <h3>Ghi chú cho ngày <span id="note-date"></span></h3>
            <textarea id="note-text-area" placeholder="Viết ghi chú của bạn..."></textarea>
            <button id="save-note-btn">Lưu Ghi Chú</button>
            <button id="close-note-btn">Đóng</button>
        </div>
    </div>
    <div id="template-modal" class="template-modal">
        <div class="template-modal-content">
            <h3>Thêm Nhanh Thói Quen Mẫu</h3>
            <ul id="template-list" class="template-list">
                </ul>
            <button id="close-template-btn">Đóng</button>
        </div>
    </div>
    <div id="theme-modal" class="note-modal">
        <div class="note-modal-content">
            <h3>Chọn Chủ Đề</h3>
            <div id="theme-buttons" class="theme-button-group">
                </div>
            <button id="close-theme-btn" style="margin-top: 20px;">Đóng</button>
        </div>
    </div>
    <div id="calendar-settings-modal" class="calendar-settings-modal">
        <div class="calendar-settings-modal-content">
            <h3>Ngày Bắt Đầu Tuần</h3>
            <div id="day-options-group" class="day-options-group">
                <button class="day-option" data-day="monday">Thứ Hai</button>
                <button class="day-option" data-day="sunday">Chủ Nhật</button>
            </div>
            <button id="close-calendar-settings-btn" style="margin-top: 20px;">Đóng</button>
        </div>
    </div>
    <div id="history-modal" class="history-modal">
        <div class="history-modal-content">
            <h3>Lịch Sử Thói Quen</h3>
            <div id="history-list-container">
                <ul id="history-list" class="history-list"></ul>
            </div>
            <button id="close-history-modal-btn">Đóng</button>
        </div>
    </div>

    <header class="header-container">
        <h1>Công Cụ Theo Dõi Thói Quen</h1>
        <p>Theo dõi tiến trình và xây dựng thói quen tốt mỗi ngày</p>
    </header>

    <main>
        <div class="habit-tracker-container">
            <h2>Quản Lý Thói Quen</h2>
            <div id="habit-list-container" class="habit-list-container">
                </div>
            
            <div class="habit-controls">
                <input type="text" id="habit-input" placeholder="Nhập tên thói quen mới...">
                <button id="add-habit-btn" class="start-btn">Thêm</button>
                <button id="show-templates-btn" class="start-btn">Thêm Nhanh</button>
                <button id="show-themes-btn" class="start-btn">Tùy Chỉnh</button>
                <button id="show-calendar-settings-btn" class="start-btn">Tùy Chỉnh Lịch</button>
                <button id="show-history-btn" class="start-btn">Lịch Sử</button>
                <button id="social-share-btn" class="start-btn">Chia Sẻ</button>
            </div>
            
            <div id="habit-details" style="display: none;">
                <div id="habit-title" class="habit-display"></div>
                
                <div class="statistics">
                    <div class="statistics-item">Chuỗi liên tiếp<span id="current-streak">0</span></div>
                    <div class="statistics-item">Tốt nhất<span id="best-streak">0</span></div>
                    <div class="statistics-item">Tỉ lệ<span id="completion-rate">0%</span></div>
                </div>
                
                <div id="calendar-view">
                    <div id="calendar-header" class="calendar-grid">
                        </div>
                    <div id="calendar-grid" class="calendar-grid">
                        </div>
                </div>

                <div class="chart-container">
                    </div>
                
                <div class="goal-container">
                    <h3 style="color: var(--accent-color);">Mục Tiêu</h3>
                    <div class="goal-input-group">
                        <input type="number" id="goal-streak-input" placeholder="Số ngày liên tiếp" min="1">
                        <button id="set-goal-btn" class="start-btn">Đặt Mục Tiêu</button>
                    </div>
                    <div id="goal-status" class="goal-status"></div>
                </div>
                
                <div class="reminder-container">
                    <h3 style="color: var(--accent-color);">Nhắc Nhở</h3>
                    <div class="reminder-input-group">
                        <input type="time" id="reminder-time-input">
                        <button id="set-reminder-btn">Đặt Nhắc Nhở</button>
                    </div>
                </div>

            </div>
            
            <div class="data-management-btns">
                <button id="export-btn">Xuất Dữ Liệu</button>
                <input type="file" id="import-file" style="display: none;">
                <button id="import-btn">Nhập Dữ Liệu</button>
            </div>
        </div>
    </main>

    <footer>
        <p>© 2025 Creative Hub. Bản quyền thuộc về Js Trung Kiên.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const habitInput = document.getElementById('habit-input');
            const addHabitBtn = document.getElementById('add-habit-btn');
            const habitListContainer = document.getElementById('habit-list-container');
            const habitDetails = document.getElementById('habit-details');
            const habitTitleEl = document.getElementById('habit-title');
            const calendarGrid = document.getElementById('calendar-grid');
            const notificationBar = document.getElementById('notification-bar');
            const currentStreakEl = document.getElementById('current-streak');
            const bestStreakEl = document.getElementById('best-streak');
            const completionRateEl = document.getElementById('completion-rate');
            const exportBtn = document.getElementById('export-btn');
            const importBtn = document.getElementById('import-btn');
            const importFileEl = document.getElementById('import-file');
            const noteModal = document.getElementById('note-modal');
            const noteDateEl = document.getElementById('note-date');
            const noteTextArea = document.getElementById('note-text-area');
            const saveNoteBtn = document.getElementById('save-note-btn');
            const closeNoteBtn = document.getElementById('close-note-btn');
            const chartContainer = document.querySelector('.chart-container');
            const goalStreakInput = document.getElementById('goal-streak-input');
            const setGoalBtn = document.getElementById('set-goal-btn');
            const goalStatusEl = document.getElementById('goal-status');
            const reminderTimeInput = document.getElementById('reminder-time-input');
            const setReminderBtn = document.getElementById('set-reminder-btn');
            const templateModal = document.getElementById('template-modal');
            const templateListEl = document.getElementById('template-list');
            const showTemplatesBtn = document.getElementById('show-templates-btn');
            const closeTemplateBtn = document.getElementById('close-template-btn');
            const themeModal = document.getElementById('theme-modal');
            const showThemesBtn = document.getElementById('show-themes-btn');
            const closeThemeBtn = document.getElementById('close-theme-btn');
            const themeButtonsContainer = document.getElementById('theme-buttons');
            const calendarSettingsModal = document.getElementById('calendar-settings-modal');
            const showCalendarSettingsBtn = document.getElementById('show-calendar-settings-btn');
            const closeCalendarSettingsBtn = document.getElementById('close-calendar-settings-btn');
            const dayOptionsGroup = document.getElementById('day-options-group');
            const calendarHeaderEl = document.getElementById('calendar-header');
            const historyModal = document.getElementById('history-modal');
            const showHistoryBtn = document.getElementById('show-history-btn');
            const historyListEl = document.getElementById('history-list');
            const closeHistoryBtn = document.getElementById('close-history-modal-btn');
            const socialShareBtn = document.getElementById('social-share-btn');

            let habits = JSON.parse(localStorage.getItem('habits')) || [];
            let selectedHabitId = localStorage.getItem('selectedHabitId') || null;
            let currentNoteDate = null;
            let startDayOfWeek = localStorage.getItem('startDayOfWeek') || 'monday';

            const habitTemplates = [
                'Uống đủ 2 lít nước',
                'Đọc sách 15 phút',
                'Tập thể dục 30 phút',
                'Ngồi thiền 10 phút',
                'Học một kỹ năng mới',
                'Đi ngủ trước 23h',
                'Viết nhật ký',
                'Dọn dẹp nhà cửa'
            ];

            const themes = {
                'Mặc định': {
                    '--main-color': '#f72585',
                    '--accent-color': '#4361ee',
                    '--button-success': '#52b788',
                    '--button-danger': '#e63964',
                    '--card-bg': '#1e1e2d',
                    '--bg-color': '#12121e',
                    '--border-color': '#2b2b3b',
                    '--text-color': '#f0f0f0',
                },
                'Xanh dương': {
                    '--main-color': '#007bff',
                    '--accent-color': '#3f7de8',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#1a2b3d',
                    '--bg-color': '#0f1f30',
                    '--border-color': '#203a55',
                    '--text-color': '#e0e8f0',
                },
                'Xanh lá': {
                    '--main-color': '#28a745',
                    '--accent-color': '#20c997',
                    '--button-success': '#198754',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#1e2d1a',
                    '--bg-color': '#101a0f',
                    '--border-color': '#253b2b',
                    '--text-color': '#e0f0e0',
                },
                'Vàng': {
                    '--main-color': '#ffc107',
                    '--accent-color': '#fd7e14',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2b251a',
                    '--bg-color': '#1f1a0f',
                    '--border-color': '#3b2b20',
                    '--text-color': '#f5f0e0',
                },
                'Tím': {
                    '--main-color': '#6f42c1',
                    '--accent-color': '#e83e8c',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#251a2d',
                    '--bg-color': '#1a0f1f',
                    '--border-color': '#3b2b3d',
                    '--text-color': '#f0e0f5',
                },
                'Đỏ': {
                    '--main-color': '#dc3545',
                    '--accent-color': '#fd7e14',
                    '--button-success': '#28a745',
                    '--button-danger': '#c82333',
                    '--card-bg': '#2d1e1a',
                    '--bg-color': '#1f120f',
                    '--border-color': '#3b2b20',
                    '--text-color': '#f0d0d0',
                },
                'Hồng': {
                    '--main-color': '#e83e8c',
                    '--accent-color': '#f72585',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2d1a25',
                    '--bg-color': '#1f121a',
                    '--border-color': '#3d2b3b',
                    '--text-color': '#f0e0e0',
                },
                'Cà phê': {
                    '--main-color': '#6c757d',
                    '--accent-color': '#495057',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#343a40',
                    '--bg-color': '#212529',
                    '--border-color': '#495057',
                    '--text-color': '#f8f9fa',
                },
                'Cam': {
                    '--main-color': '#fd7e14',
                    '--accent-color': '#ffc107',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2d251a',
                    '--bg-color': '#1f1a0f',
                    '--border-color': '#3b2b20',
                    '--text-color': '#f0e8d0',
                },
                'Neon xanh': {
                    '--main-color': '#00ffff',
                    '--accent-color': '#00a3a3',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#122d2d',
                    '--bg-color': '#0a1a1a',
                    '--border-color': '#1a3d3d',
                    '--text-color': '#d0f0f0',
                },
                'Xám': {
                    '--main-color': '#6c757d',
                    '--accent-color': '#adb5bd',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#212529',
                    '--bg-color': '#1b1e22',
                    '--border-color': '#343a40',
                    '--text-color': '#e9ecef',
                },
                'Vàng chanh': {
                    '--main-color': '#ffc107',
                    '--accent-color': '#ffeb3b',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2d2d1a',
                    '--bg-color': '#1f1f0a',
                    '--border-color': '#3d3d1a',
                    '--text-color': '#f5f5e0',
                },
                'Thủy thủ': {
                    '--main-color': '#0d6efd',
                    '--accent-color': '#0b5ed7',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#152b4d',
                    '--bg-color': '#0a1a30',
                    '--border-color': '#1a3d6d',
                    '--text-color': '#e0f0ff',
                },
                'Đỏ tươi': {
                    '--main-color': '#dc3545',
                    '--accent-color': '#f05d5d',
                    '--button-success': '#28a745',
                    '--button-danger': '#c82333',
                    '--card-bg': '#2d1a1a',
                    '--bg-color': '#1f0a0a',
                    '--border-color': '#3d1a1a',
                    '--text-color': '#f0d0d0',
                },
                'Hồng tươi': {
                    '--main-color': '#e83e8c',
                    '--accent-color': '#f06292',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2d1a25',
                    '--bg-color': '#1f121a',
                    '--border-color': '#3d2b3b',
                    '--text-color': '#f0e0f0',
                },
                'Xanh lá cây': {
                    '--main-color': '#28a745',
                    '--accent-color': '#43c445',
                    '--button-success': '#198754',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#1a2d1a',
                    '--bg-color': '#0a1f0a',
                    '--border-color': '#1a3d1a',
                    '--text-color': '#e0f0e0',
                },
                'Tím than': {
                    '--main-color': '#6f42c1',
                    '--accent-color': '#825ad8',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#251a2d',
                    '--bg-color': '#1a0f1f',
                    '--border-color': '#2d1a3d',
                    '--text-color': '#f0e0f0',
                },
                'Vàng đất': {
                    '--main-color': '#ffc107',
                    '--accent-color': '#e6b500',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2d251a',
                    '--bg-color': '#1f1a0a',
                    '--border-color': '#3d2d1a',
                    '--text-color': '#f5f5e0',
                },
                'Neon đỏ': {
                    '--main-color': '#ff0000',
                    '--accent-color': '#e60000',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#2d1a1a',
                    '--bg-color': '#1f0a0a',
                    '--border-color': '#3d1a1a',
                    '--text-color': '#f0d0d0',
                },
                'Hải quân': {
                    '--main-color': '#001f3f',
                    '--accent-color': '#0074d9',
                    '--button-success': '#28a745',
                    '--button-danger': '#dc3545',
                    '--card-bg': '#102030',
                    '--bg-color': '#05101a',
                    '--border-color': '#15304a',
                    '--text-color': '#e0f0ff',
                },
            };


            function showNotification(message, type) {
                notificationBar.textContent = message;
                notificationBar.classList.add(type);
                notificationBar.classList.add('show');
                setTimeout(() => {
                    notificationBar.classList.remove('show');
                    setTimeout(() => {
                        notificationBar.classList.remove(type);
                    }, 500);
                }, 2000);
            }

            function saveHabits() {
                localStorage.setItem('habits', JSON.stringify(habits));
                localStorage.setItem('selectedHabitId', selectedHabitId);
            }
            
            function calculateStats(habit) {
                if (!habit) {
                    currentStreakEl.textContent = '0';
                    bestStreakEl.textContent = '0';
                    completionRateEl.textContent = '0%';
                    return;
                }

                const today = new Date();
                const completedDates = new Set(habit.completedDates);
                
                let currentStreak = 0;
                let bestStreak = 0;
                let tempStreak = 0;
                let totalCompleted = 0;
                
                const sortedDates = [...completedDates].sort();
                if (sortedDates.length > 0) {
                    let lastCompletedDay = new Date(sortedDates[sortedDates.length - 1]);
                    
                    let day = new Date(today);
                    let tempCurrentStreak = 0;
                    while(completedDates.has(day.toISOString().slice(0, 10)) || completedDates.has(new Date(day.getTime() - 86400000).toISOString().slice(0, 10))){
                        if (completedDates.has(day.toISOString().slice(0, 10))) {
                            tempCurrentStreak++;
                            day.setDate(day.getDate() - 1);
                        } else if (completedDates.has(new Date(day.getTime() - 86400000).toISOString().slice(0, 10))) {
                             day.setDate(day.getDate() - 1);
                        } else {
                            break;
                        }
                    }
                    currentStreak = tempCurrentStreak;
                    
                    tempStreak = 0;
                    for (let i = 0; i < sortedDates.length; i++) {
                        tempStreak++;
                        if (i > 0) {
                            const prevDay = new Date(sortedDates[i-1]);
                            const currentDay = new Date(sortedDates[i]);
                            const diffTime = Math.abs(currentDay - prevDay);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            if (diffDays > 1) {
                                bestStreak = Math.max(bestStreak, tempStreak-1);
                                tempStreak = 1;
                            }
                        }
                    }
                    bestStreak = Math.max(bestStreak, tempStreak);
                    
                    totalCompleted = completedDates.size;
                }

                const totalDays = Math.floor((today - new Date(habit.createdAt)) / (1000 * 60 * 60 * 24)) + 1;
                const completionRate = totalDays > 0 ? ((totalCompleted / totalDays) * 100).toFixed(0) : 0;
                
                currentStreakEl.textContent = currentStreak;
                bestStreakEl.textContent = bestStreak;
                completionRateEl.textContent = `${completionRate}%`;

                if (habit.goal && habit.goal.type === 'streak' && habit.goal.value <= bestStreak) {
                    goalStatusEl.textContent = `Đã đạt mục tiêu ${habit.goal.value} ngày liên tiếp!`;
                    goalStatusEl.classList.add('achieved');
                } else if (habit.goal) {
                    goalStatusEl.textContent = `Mục tiêu: ${habit.goal.value} ngày liên tiếp`;
                    goalStatusEl.classList.remove('achieved');
                } else {
                    goalStatusEl.textContent = 'Chưa có mục tiêu';
                    goalStatusEl.classList.remove('achieved');
                }
            }

            function renderProgressChart(habit) {
                if (!habit) {
                    chartContainer.innerHTML = '';
                    return;
                }

                chartContainer.innerHTML = '';
                const today = new Date();
                const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
                const completedDates = new Set(habit.completedDates);

                for (let i = 1; i <= daysInMonth; i++) {
                    const bar = document.createElement('div');
                    bar.classList.add('chart-bar');
                    const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    
                    if (completedDates.has(dateString)) {
                        bar.style.height = '100%';
                        bar.dataset.day = i;
                    } else {
                        bar.style.height = '0%';
                        bar.dataset.day = i;
                    }
                    chartContainer.appendChild(bar);
                }
            }


            function renderHabitButtons() {
                habitListContainer.innerHTML = '';
                habits.forEach(habit => {
                    const habitBtn = document.createElement('button');
                    habitBtn.classList.add('select-habit-btn');
                    habitBtn.textContent = habit.name;
                    habitBtn.dataset.id = habit.id;
                    if (habit.id == selectedHabitId) {
                        habitBtn.style.backgroundColor = 'var(--main-color)';
                    }
                    habitListContainer.appendChild(habitBtn);
                });
            }
            
            function renderCalendarHeader() {
                calendarHeaderEl.innerHTML = '';
                const weekdays = ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'];
                const weekdaysSundayStart = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
                
                const daysToRender = (startDayOfWeek === 'sunday') ? weekdaysSundayStart : weekdays;
                daysToRender.forEach(day => {
                    const headerCell = document.createElement('div');
                    headerCell.classList.add('calendar-header');
                    headerCell.textContent = day;
                    calendarHeaderEl.appendChild(headerCell);
                });
            }


            function renderCalendar() {
                calendarGrid.innerHTML = '';
                renderCalendarHeader();
                const today = new Date();
                const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
                let firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1).getDay(); // 0-6: CN-T7
                
                if (startDayOfWeek === 'monday') {
                    firstDayOfMonth = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;
                }

                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                const completedDates = selectedHabit ? new Set(selectedHabit.completedDates) : new Set();
                const notes = selectedHabit ? selectedHabit.notes || {} : {};

                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.classList.add('day-cell');
                    emptyCell.style.visibility = 'hidden';
                    calendarGrid.appendChild(emptyCell);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayCell = document.createElement('div');
                    dayCell.classList.add('day-cell', 'clickable');
                    dayCell.textContent = i;
                    
                    const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    dayCell.dataset.date = dateString;

                    if (completedDates.has(dateString)) {
                        dayCell.classList.add('completed');
                    }
                    
                    if (i === today.getDate()) {
                        dayCell.classList.add('current-day');
                    }

                    if (notes[dateString]) {
                        dayCell.classList.add('has-note');
                    }
                    
                    const noteIcon = document.createElement('i');
                    noteIcon.classList.add('fa-solid', 'fa-pencil', 'note-icon');
                    dayCell.appendChild(noteIcon);

                    calendarGrid.appendChild(dayCell);
                }
            }

            function openNoteModal(date) {
                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                const noteText = selectedHabit.notes ? selectedHabit.notes[date] || '' : '';
                noteDateEl.textContent = date;
                noteTextArea.value = noteText;
                currentNoteDate = date;
                noteModal.style.display = 'block';
            }

            function handleDayClick(event) {
                const dayCell = event.target.closest('.day-cell');
                if (!dayCell || !dayCell.dataset.date) return;
                
                const date = dayCell.dataset.date;
                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                if (!selectedHabit) return;

                if (event.target.classList.contains('note-icon')) {
                     openNoteModal(date);
                     return;
                }

                const dateIndex = selectedHabit.completedDates.indexOf(date);
                if (dateIndex > -1) {
                    selectedHabit.completedDates.splice(dateIndex, 1);
                    showNotification('Đã bỏ chọn ngày!', 'error');
                } else {
                    selectedHabit.completedDates.push(date);
                    showNotification('Hoàn thành thói quen!', 'success');
                }
                
                saveHabits();
                renderCalendar();
                calculateStats(selectedHabit);
                renderProgressChart(selectedHabit);
            }

            function addHabit(habitName) {
                if (habitName) {
                    const newHabit = {
                        id: Date.now(),
                        name: habitName,
                        completedDates: [],
                        notes: {},
                        createdAt: new Date().toISOString().slice(0, 10),
                        goal: null,
                        reminderTime: null
                    };
                    habits.push(newHabit);
                    habitInput.value = '';
                    selectedHabitId = newHabit.id;
                    saveHabits();
                    loadUI();
                    showNotification('Đã thêm thói quen mới!', 'success');
                }
            }
            
            function selectHabit(event) {
                const button = event.target.closest('.select-habit-btn');
                if (!button) return;
                selectedHabitId = parseInt(button.dataset.id);
                saveHabits();
                loadUI();
            }

            function exportData() {
                if (habits.length === 0) {
                    showNotification('Không có dữ liệu để xuất!', 'error');
                    return;
                }
                const dataStr = JSON.stringify(habits, null, 2);
                const blob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'habit-data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showNotification('Đã xuất dữ liệu thành công!', 'success');
            }

            function importData() {
                importFileEl.click();
            }

            function handleImportFile(event) {
                const file = event.target.files[0];
                if (!file) {
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedHabits = JSON.parse(e.target.result);
                        if (Array.isArray(importedHabits)) {
                            habits = importedHabits;
                            selectedHabitId = null;
                            saveHabits();
                            loadUI();
                            showNotification('Đã nhập dữ liệu thành công!', 'success');
                        } else {
                            showNotification('Tệp tin không hợp lệ.', 'error');
                        }
                    } catch (error) {
                        showNotification('Lỗi khi đọc tệp tin!', 'error');
                    }
                };
                reader.readAsText(file);
            }

            function saveNote() {
                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                if (selectedHabit) {
                    const noteText = noteTextArea.value.trim();
                    if (noteText) {
                        if (!selectedHabit.notes) {
                            selectedHabit.notes = {};
                        }
                        selectedHabit.notes[currentNoteDate] = noteText;
                        showNotification('Đã lưu ghi chú!', 'success');
                    } else {
                        if (selectedHabit.notes && selectedHabit.notes[currentNoteDate]) {
                             delete selectedHabit.notes[currentNoteDate];
                             showNotification('Đã xóa ghi chú!', 'success');
                        }
                    }
                    saveHabits();
                    renderCalendar();
                    closeNoteModal();
                }
            }

            function closeNoteModal() {
                noteModal.style.display = 'none';
            }

            function setGoal() {
                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                const goalValue = parseInt(goalStreakInput.value);
                if (selectedHabit && !isNaN(goalValue) && goalValue > 0) {
                    selectedHabit.goal = { type: 'streak', value: goalValue };
                    saveHabits();
                    calculateStats(selectedHabit);
                    showNotification('Đã đặt mục tiêu thành công!', 'success');
                } else {
                    showNotification('Vui lòng nhập một số hợp lệ!', 'error');
                }
            }
            
            function checkReminders() {
                const today = new Date();
                const todayDateString = today.toISOString().slice(0, 10);
                const selectedHabit = habits.find(h => h.id == selectedHabitId);

                if (!selectedHabit || !selectedHabit.reminderTime || selectedHabit.completedDates.includes(todayDateString)) {
                    return;
                }
                
                const [hour, minute] = selectedHabit.reminderTime.split(':');
                const reminderTime = new Date();
                reminderTime.setHours(hour, minute, 0, 0);

                if (today.getTime() > reminderTime.getTime() && reminderTime.getTime() < new Date().setHours(23, 59, 59, 999)) {
                    const audio = new Audio('path/to/your/sound.mp3'); // Thêm âm thanh nhắc nhở
                    audio.play();
                    showNotification(`Đã quá giờ, anh Kiên ơi! Anh đã hoàn thành thói quen '${selectedHabit.name}' chưa?`, 'error');
                }
            }

            function renderHabitTemplates() {
                templateListEl.innerHTML = '';
                habitTemplates.forEach(template => {
                    const li = document.createElement('li');
                    li.classList.add('template-item');
                    li.textContent = template;
                    templateListEl.appendChild(li);
                });
            }
            
            function applyTheme(themeName) {
                const body = document.body;
                
                const selectedTheme = themes[themeName];
                for (const prop in selectedTheme) {
                    document.documentElement.style.setProperty(prop, selectedTheme[prop]);
                }
                localStorage.setItem('selectedTheme', themeName);

                document.querySelectorAll('.theme-swatch').forEach(swatch => {
                    swatch.classList.remove('active');
                });
                document.querySelector(`.theme-swatch[data-theme="${themeName}"]`).classList.add('active');
            }
            
            function renderThemeSwatches() {
                themeButtonsContainer.innerHTML = '';
                for (const themeName in themes) {
                    const themeColors = themes[themeName];
                    const swatch = document.createElement('button');
                    swatch.classList.add('theme-swatch');
                    swatch.dataset.theme = themeName;
                    swatch.style.backgroundColor = themeColors['--main-color'];
                    themeButtonsContainer.appendChild(swatch);
                }
            }
            
            function setStartDayOfWeek(day) {
                startDayOfWeek = day;
                localStorage.setItem('startDayOfWeek', day);
                renderCalendar();
                showNotification(`Ngày bắt đầu tuần đã được đặt là ${day === 'monday' ? 'Thứ Hai' : 'Chủ Nhật'}`, 'success');

                document.querySelectorAll('.day-option').forEach(option => {
                    option.classList.remove('active');
                });
                document.querySelector(`.day-option[data-day="${day}"]`).classList.add('active');
            }
            
            function renderHistoryList() {
                historyListEl.innerHTML = '';
                if (habits.length === 0) {
                    historyListEl.innerHTML = '<li style="text-align:center; color:var(--secondary-text-color);">Không có lịch sử</li>';
                    return;
                }
                habits.forEach(habit => {
                    const li = document.createElement('li');
                    li.classList.add('history-item');
                    const createdAt = new Date(habit.createdAt).toLocaleDateString('vi-VN');
                    li.innerHTML = `
                        <h4>${habit.name}</h4>
                        <p>Bắt đầu từ: ${createdAt}</p>
                        <button class="load-btn" data-id="${habit.id}">Xem</button>
                    `;
                    historyListEl.appendChild(li);
                });
            }

            function loadUI() {
                const savedTheme = localStorage.getItem('selectedTheme') || 'Mặc định';
                applyTheme(savedTheme);

                const savedStartDay = localStorage.getItem('startDayOfWeek') || 'monday';
                setStartDayOfWeek(savedStartDay);

                if (habits.length > 0) {
                    if (!selectedHabitId) {
                        selectedHabitId = habits[0].id;
                    }
                    const selectedHabit = habits.find(h => h.id == selectedHabitId);
                    if (selectedHabit) {
                        habitDetails.style.display = 'block';
                        habitTitleEl.textContent = selectedHabit.name;
                        goalStreakInput.value = selectedHabit.goal ? selectedHabit.goal.value : '';
                        reminderTimeInput.value = selectedHabit.reminderTime || '';
                        renderHabitButtons();
                        renderCalendar();
                        calculateStats(selectedHabit);
                        renderProgressChart(selectedHabit);
                        checkReminders();
                    }
                } else {
                    habitDetails.style.display = 'none';
                    renderHabitButtons();
                }
            }
            
            addHabitBtn.addEventListener('click', () => {
                const habitName = habitInput.value.trim();
                addHabit(habitName);
            });
            habitInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const habitName = habitInput.value.trim();
                    addHabit(habitName);
                }
            });
            habitListContainer.addEventListener('click', selectHabit);
            calendarGrid.addEventListener('click', handleDayClick);
            exportBtn.addEventListener('click', exportData);
            importBtn.addEventListener('click', importData);
            importFileEl.addEventListener('change', handleImportFile);
            saveNoteBtn.addEventListener('click', saveNote);
            closeNoteBtn.addEventListener('click', closeNoteModal);
            setGoalBtn.addEventListener('click', setGoal);
            showTemplatesBtn.addEventListener('click', () => {
                renderHabitTemplates();
                templateModal.style.display = 'block';
            });
            closeTemplateBtn.addEventListener('click', () => {
                templateModal.style.display = 'none';
            });
            templateListEl.addEventListener('click', (e) => {
                const habitName = e.target.textContent;
                if(habitName) {
                    addHabit(habitName);
                    templateModal.style.display = 'none';
                }
            });

            showThemesBtn.addEventListener('click', () => {
                renderThemeSwatches();
                themeModal.style.display = 'block';
            });

            closeThemeBtn.addEventListener('click', () => {
                themeModal.style.display = 'none';
            });
            
            themeButtonsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('theme-swatch')) {
                    const themeName = e.target.dataset.theme;
                    applyTheme(themeName);
                    showNotification(`Đã đổi chủ đề sang ${themeName}!`, 'success');
                }
            });

            showCalendarSettingsBtn.addEventListener('click', () => {
                calendarSettingsModal.style.display = 'block';
            });

            closeCalendarSettingsBtn.addEventListener('click', () => {
                calendarSettingsModal.style.display = 'none';
            });

            dayOptionsGroup.addEventListener('click', (e) => {
                const day = e.target.dataset.day;
                if (day) {
                    setStartDayOfWeek(day);
                    calendarSettingsModal.style.display = 'none';
                }
            });
            
            showHistoryBtn.addEventListener('click', () => {
                renderHistoryList();
                historyModal.style.display = 'block';
            });

            closeHistoryBtn.addEventListener('click', () => {
                historyModal.style.display = 'none';
            });

            historyListEl.addEventListener('click', (e) => {
                const button = e.target.closest('.load-btn');
                if (button) {
                    selectedHabitId = parseInt(button.dataset.id);
                    saveHabits();
                    loadUI();
                    historyModal.style.display = 'none';
                    showNotification('Đã tải thói quen cũ!', 'success');
                }
            });
            
            setReminderBtn.addEventListener('click', () => {
                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                if (selectedHabit) {
                    selectedHabit.reminderTime = reminderTimeInput.value;
                    saveHabits();
                    showNotification('Đã đặt nhắc nhở thành công!', 'success');
                }
            });
            
            socialShareBtn.addEventListener('click', () => {
                const selectedHabit = habits.find(h => h.id == selectedHabitId);
                if (!selectedHabit) return;

                const message = `Tôi đã đạt chuỗi ${currentStreakEl.textContent} ngày liên tiếp với thói quen '${selectedHabit.name}'! 🎉`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Thành tích theo dõi thói quen',
                        text: message,
                        url: window.location.href,
                    })
                    .then(() => showNotification('Đã chia sẻ thành công!', 'success'))
                    .catch((error) => console.log('Lỗi khi chia sẻ', error));
                } else {
                    navigator.clipboard.writeText(message)
                        .then(() => showNotification('Đã sao chép vào clipboard!', 'success'))
                        .catch((error) => console.error('Lỗi khi sao chép:', error));
                }
            });


            loadUI();
        });
    </script>
</body>
</html>