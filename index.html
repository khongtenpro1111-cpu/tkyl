<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª≠ Th√°ch S√°ng T·∫°o M·ªói Ng√†y</title>
 
    <link rel="stylesheet" href="index.css">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="side-menu" class="hidden">
        <div class="menu-header">
            <span class="close-menu-btn">√ó</span>
        </div>
        <nav id="main-nav">
            <ul>
                <li><a href="intex.html">Trang ch·ªß</a></li>
                <li><a href="thuthach.html">Th·ª≠ th√°ch</a></li>
                <li><a href="khotruyen.html">Kho truy·ªán</a></li>
                <li><a href="danhmuccongnghe.html">C√¥ng ngh·ªá</a></li>
                <li><a href="kynangmem.html">K·ªπ nƒÉng m·ªÅm</a></li>
                <li><a href="khoinguoncamhung.html">C·∫£m h·ª©ng</a></li>
                <li><a href="trochoi.html">Tr√≤ ch∆°i</a></li>
                <li><a href="binhchonthuthach.htlm">B√¨nh ch·ªçn</a></li>
                <li><a href="cactacphamcongdong.html">T√°c ph·∫©m c·ªông ƒë·ªìng</a></li>
            </ul>
        </nav>
    </div>
    
    <header class="header-container">
        <div id="auth-container">
            <div id="login-form">
                <input type="text" id="username-input" placeholder="T√™n ƒëƒÉng nh·∫≠p">
                <button id="login-btn">ƒêƒÉng nh·∫≠p</button>
            </div>
            <div id="user-info" style="display: none;">
                <span id="user-display"></span>
                <button id="logout-btn">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
        <div id="header-content">
            <span class="open-menu-btn">‚ò∞</span>
            <h1>Th·ª≠ Th√°ch S√°ng T·∫°o M·ªói Ng√†y</h1>
        </div>
        <p>Kh∆°i d·∫≠y ni·ªÅm ƒëam m√™ v√† s√°ng t·∫°o c·ªßa b·∫°n</p>
        <div id="search-container">
            <input type="text" id="search-input" placeholder="T√¨m ki·∫øm t√°c ph·∫©m...">
        </div>
    </header>

    <main>
        <div class="card-grid">
            <a href="thuthach.html" class="card-link" data-search-terms="th·ª≠ th√°ch h√¥m nay h√†ng ng√†y">
                <div class="challenge-card">
                    <h2>Th·ª≠ th√°ch h√¥m nay</h2>
                    <p>Nh·∫•n v√†o ƒë√¢y ƒë·ªÉ xem v√† tham gia th·ª≠ th√°ch h√†ng ng√†y!</p>
                </div>
            </a>

            <a href="khotruyen.html" class="card-link" data-search-terms="kho truy·ªán online c√¢u chuy·ªán c·∫£m h·ª©ng">
                <div class="challenge-card">
                    <h2>Kho truy·ªán online</h2>
                    <p>Kh√°m ph√° nh·ªØng c√¢u chuy·ªán th√∫ v·ªã v√† ƒë·∫ßy c·∫£m h·ª©ng!</p>
                </div>
            </a>

            <a href="danhmuccongnghe.html" class="card-link" data-search-terms="danh m·ª•c c√¥ng ngh·ªá t∆∞∆°ng lai s·∫£n ph·∫©m ƒë·ªôc ƒë√°o">
                <div class="challenge-card">
                    <h2>Danh m·ª•c C√¥ng ngh·ªá T∆∞∆°ng lai</h2>
                    <p>Kh√°m ph√° c√°c s·∫£n ph·∫©m c√¥ng ngh·ªá ƒë·ªôc ƒë√°o v√† t∆∞∆°ng lai!</p>
                </div>
            </a>

            <a href="khoinguoncamhung.html" class="card-link" data-search-terms="kh∆°i ngu·ªìn c·∫£m h·ª©ng √Ω t∆∞·ªüng s√°ng t·∫°o">
                <div class="challenge-card">
                    <h2>üí° Kh∆°i ngu·ªìn C·∫£m h·ª©ng</h2>
                    <p>Nh·∫•n v√†o ƒë√¢y ƒë·ªÉ t√¨m √Ω t∆∞·ªüng s√°ng t·∫°o cho ri√™ng b·∫°n!</p>
                </div>
            </a>
            
            <a href="kynangmem.html" class="card-link" data-search-terms="danh m·ª•c k·ªπ nƒÉng m·ªÅm ph√°t tri·ªÉn b·∫£n th√¢n">
                <div class="challenge-card">
                    <h2>Danh m·ª•c K·ªπ nƒÉng m·ªÅm</h2>
                    <p>Kh√°m ph√° v√† r√®n luy·ªán c√°c k·ªπ nƒÉng m·ªÅm thi·∫øt y·∫øu!</p>
                </div>
            </a>

            <a href="trochoi.html" class="card-link" data-search-terms="danh m·ª•c tr√≤ ch∆°i gi·∫£i tr√≠ th√∫ v·ªã">
                <div class="challenge-card">
                    <h2>Danh M·ª•c Tr√≤ Ch∆°i</h2>
                    <p>Gi·∫£i tr√≠ v·ªõi c√°c tr√≤ ch∆°i nh·ªè th√∫ v·ªã!</p>
                </div>
            </a>
        </div>
        
        <section id="challenge-voting" class="section-container">
            <h2>B√¨nh ch·ªçn th·ª≠ th√°ch tu·∫ßn n√†y</h2>
            <div id="proposed-challenges-container" class="challenge-voting-grid">
            </div>
            <button id="propose-challenge-btn" class="propose-btn" style="display: none;">ƒê·ªÅ xu·∫•t th·ª≠ th√°ch m·ªõi</button>
        </section>
        
        <section id="leaderboard" class="section-container">
            <h2>üèÜ B·∫£ng x·∫øp h·∫°ng Ng∆∞·ªùi d√πng</h2>
            <div id="leaderboard-container">
                </div>
        </section>

        <section id="hall-of-fame" class="section-container">
            <h2>üèÜ B·∫£ng v√†ng S√°ng t·∫°o</h2>
            <div id="top-posts-container" class="grid-container">
            </div>
        </section>

        <section id="community-feed" class="section-container">
            <h2>C√°c t√°c ph·∫©m c·ªßa c·ªông ƒë·ªìng</h2>
            <div id="posts-container" class="grid-container">
            </div>
        </section>

        <section id="contact-section" class="section-container">
            <h2>Li√™n h·ªá & Th√¥ng tin c·ª≠a h√†ng</h2>
            <div class="contact-container">
                <div class="contact-info">
                    <h3>Th√¥ng tin li√™n h·ªá</h3>
                    <p><strong>Hotline:</strong> 09xx.xxx.xxx</p>
                    <p><strong>Email:</strong> info@yourstore.com</p>
                    <p><strong>Gi·ªù l√†m vi·ªác:</strong> 8:00 - 18:00 (Th·ª© Hai - Th·ª© B·∫£y)</p>
                </div>
    
                <div class="store-info">
                    <h3>ƒê·ªãa ch·ªâ c·ª≠a h√†ng</h3>
                    <p><strong>ƒê·ªãa ch·ªâ:</strong> 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, Th√†nh ph·ªë H·ªì Ch√≠ Minh</p>
                    <p>Ch√∫ng em lu√¥n ch√†o ƒë√≥n qu√Ω kh√°ch h√†ng ƒë·∫øn tham quan v√† tr·∫£i nghi·ªám!</p>
                </div>
    
                <div class="map-container">
                    <iframe src="https://maps.google.com/maps?q=123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, Th√†nh ph·ªë H·ªì Ch√≠ Minh&t=&z=13&ie=UTF8&iwloc=&output=embed" allowfullscreen="" loading="lazy"></iframe>
                </div>
    
                <div class="contact-form">
                    <h3>G·ª≠i tin nh·∫Øn cho ch√∫ng t√¥i</h3>
                    <form id="contactForm">
                        <input type="text" id="name" name="name" placeholder="T√™n c·ªßa b·∫°n" required>
                        <input type="email" id="email" name="email" placeholder="Email c·ªßa b·∫°n" required>
                        <textarea id="message" name="message" rows="5" placeholder="N·ªôi dung tin nh·∫Øn..." required></textarea>
                        <button type="submit">G·ª≠i tin nh·∫Øn</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <div id="challenge-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">√ó</span>
            <h2>ƒê·ªÅ xu·∫•t Th·ª≠ th√°ch m·ªõi</h2>
            <form id="propose-challenge-form">
                <textarea id="new-challenge-text" placeholder="Nh·∫≠p th·ª≠ th√°ch c·ªßa b·∫°n..." required></textarea>
                <button type="submit">G·ª≠i ƒë·ªÅ xu·∫•t</button>
            </form>
        </div>
    </div>

    <footer>
        <p>¬© 2025 Creative Hub. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
    </footer>

    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-cart-btn">√ó</span>
            <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
            <div id="cart-items-container">
            </div>
            <div class="cart-summary">
                <h3>T·ªïng c·ªông: <span id="cart-total">0 VNƒê</span></h3>
                <button id="checkout-btn">Thanh to√°n</button>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-checkout-btn">√ó</span>
            <h2>Th√¥ng tin thanh to√°n</h2>
            <form id="checkout-form">
                <label for="customer-name">H·ªç v√† t√™n:</label>
                <input type="text" id="customer-name" required>
                <label for="customer-address">ƒê·ªãa ch·ªâ:</label>
                <input type="text" id="customer-address" required>
                <label for="customer-phone">S·ªë ƒëi·ªán tho·∫°i:</label>
                <input type="tel" id="customer-phone" required>
                <button type="submit">X√°c nh·∫≠n thanh to√°n</button>
            </form>
        </div>
    </div>

    <div id="notification-modal" class="modal">
        <div class="modal-content">
            <p id="notification-message"></p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Khai b√°o c√°c ph·∫ßn t·ª≠ DOM
            const loginForm = document.getElementById('login-form');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const usernameInput = document.getElementById('username-input');
            const userInfo = document.getElementById('user-info');
            const userDisplay = document.getElementById('user-display');
            const searchInput = document.getElementById('search-input');
            const postsContainer = document.getElementById('posts-container');
            const topPostsContainer = document.getElementById('top-posts-container');
            const leaderboardContainer = document.getElementById('leaderboard-container');
            const proposeChallengeBtn = document.getElementById('propose-challenge-btn');
            const challengeModal = document.getElementById('challenge-modal');
            const challengeForm = document.getElementById('propose-challenge-form');
            const newChallengeInput = document.getElementById('new-challenge-text');
            const proposedChallengesContainer = document.getElementById('proposed-challenges-container');
            const challengeIdInput = document.getElementById('challenge-id');
            const notificationModal = document.getElementById('notification-modal');
            const notificationMessage = document.getElementById('notification-message');
            const cardGrid = document.querySelector('.card-grid');
            const allCards = Array.from(document.querySelectorAll('.card-link'));
            const closeChallengeModalBtn = document.querySelector('#challenge-modal .close-btn');

            const openMenuBtn = document.querySelector('.open-menu-btn');
            const closeMenuBtn = document.querySelector('.close-menu-btn');
            const sideMenu = document.getElementById('side-menu');

            // X·ª≠ l√Ω menu b√™n
            openMenuBtn.addEventListener('click', () => {
                sideMenu.classList.remove('hidden');
                sideMenu.classList.add('open');
            });

            closeMenuBtn.addEventListener('click', () => {
                sideMenu.classList.remove('open');
                sideMenu.classList.add('hidden');
            });

            // D·ªØ li·ªáu v√† tr·∫°ng th√°i ng∆∞·ªùi d√πng
            let currentUser = localStorage.getItem('currentUser');
            const ADMIN_USER = 'Trung Kien';
            let posts = JSON.parse(localStorage.getItem('creativePosts')) || [];
            let userPoints = JSON.parse(localStorage.getItem('userPoints')) || {};
            let proposedChallenges = JSON.parse(localStorage.getItem('proposedChallenges')) || [];

            // C√°c h√†m x·ª≠ l√Ω d·ªØ li·ªáu
            function savePosts() {
                localStorage.setItem('creativePosts', JSON.stringify(posts));
            }
            
            function saveUserPoints() {
                localStorage.setItem('userPoints', JSON.stringify(userPoints));
            }

            function updateUserPoints(username, pointsToAdd) {
                if (!userPoints[username]) {
                    userPoints[username] = 0;
                }
                userPoints[username] += pointsToAdd;
                saveUserPoints();
            }

            function saveChallenges() {
                localStorage.setItem('proposedChallenges', JSON.stringify(proposedChallenges));
            }

            // H√†m hi·ªÉn th·ªã th√¥ng b√°o
            function showNotification(message) {
                notificationMessage.textContent = message;
                notificationModal.style.display = 'block';
                setTimeout(() => {
                    notificationModal.style.display = 'none';
                }, 3000); // T·ª± ƒë·ªông ƒë√≥ng sau 3 gi√¢y
            }
            
            // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
            function handleLogin() {
                const username = usernameInput.value.trim();
                if (username) {
                    localStorage.setItem('currentUser', username);
                    currentUser = username;
                    updateUIForUser(username);
                    showNotification(`Ch√†o m·ª´ng ${username} ƒë√£ tr·ªü l·∫°i!`);
                }
            }

            if (loginBtn) {
                loginBtn.addEventListener('click', handleLogin);
            }

            if (usernameInput) {
                usernameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleLogin();
                    }
                });
            }

            // X·ª≠ l√Ω ƒëƒÉng xu·∫•t
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('currentUser');
                    currentUser = null;
                    updateUIForUser(null);
                    showNotification("B·∫°n ƒë√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!");
                });
            }

            // H√†m c·∫≠p nh·∫≠t giao di·ªán ng∆∞·ªùi d√πng
            function updateUIForUser(username) {
                if (username) {
                    loginForm.style.display = 'none';
                    userInfo.style.display = 'flex';
                    userDisplay.textContent = username;
                    proposeChallengeBtn.style.display = 'inline-block';
                } else {
                    loginForm.style.display = 'flex';
                    userInfo.style.display = 'none';
                    proposeChallengeBtn.style.display = 'none';
                }
                renderPosts();
            }

            // Ch·ª©c nƒÉng t√¨m ki·∫øm
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredCards = allCards.filter(card => {
                    const searchTerms = card.dataset.searchTerms.toLowerCase();
                    return searchTerms.includes(query);
                });
                
                cardGrid.innerHTML = '';
                if (filteredCards.length > 0) {
                    filteredCards.forEach(card => cardGrid.appendChild(card));
                } else {
                    cardGrid.innerHTML = '<p style="text-align:center; color:var(--secondary-text-color);">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.</p>';
                }
            });

            // X·ª≠ l√Ω ch·ª©c nƒÉng b√¨nh ch·ªçn th·ª≠ th√°ch
            proposeChallengeBtn.addEventListener('click', () => {
                if (currentUser) {
                    challengeModal.style.display = 'block';
                } else {
                    showNotification("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë·ªÅ xu·∫•t th·ª≠ th√°ch!");
                }
            });

            closeChallengeModalBtn.addEventListener('click', () => {
                challengeModal.style.display = 'none';
            });
            
            challengeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newChallengeText = newChallengeInput.value.trim();
                if (newChallengeText) {
                    const newChallenge = {
                        id: Date.now(),
                        text: newChallengeText,
                        author: currentUser,
                        votes: 0
                    };
                    proposedChallenges.push(newChallenge);
                    saveChallenges();
                    renderProposedChallenges();
                    challengeModal.style.display = 'none';
                    challengeForm.reset();
                    showNotification("ƒê·ªÅ xu·∫•t th·ª≠ th√°ch ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!");
                }
            });

            function renderProposedChallenges() {
                proposedChallengesContainer.innerHTML = '';
                proposedChallenges.forEach(challenge => {
                    const challengeElement = document.createElement('div');
                    challengeElement.classList.add('challenge-voting-item');

                    let manageBtnsHtml = '';
                    if (currentUser && (challenge.author === currentUser || currentUser === ADMIN_USER)) {
                        manageBtnsHtml = `
                            <button class="edit-challenge-btn" data-id="${challenge.id}">S·ª≠a</button>
                            <button class="delete-challenge-btn" data-id="${challenge.id}">X√≥a</button>
                        `;
                    }
                    
                    challengeElement.innerHTML = `
                        <p>${challenge.text}</p>
                        <div class="voting-actions">
                            <button class="vote-btn" data-id="${challenge.id}">üëç <span class="vote-count">${challenge.votes}</span></button>
                            <span class="challenge-author">ƒê·ªÅ xu·∫•t b·ªüi: ${challenge.author}</span>
                            ${manageBtnsHtml}
                        </div>
                    `;
                    proposedChallengesContainer.appendChild(challengeElement);
                });
                
                document.querySelectorAll('.vote-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!currentUser) {
                            showNotification("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ b√¨nh ch·ªçn!");
                            return;
                        }
                        const id = parseInt(e.currentTarget.dataset.id);
                        const challengeToUpdate = proposedChallenges.find(c => c.id === id);
                        if (challengeToUpdate) {
                            challengeToUpdate.votes++;
                            saveChallenges();
                            renderProposedChallenges();
                            showNotification("B·∫°n ƒë√£ b√¨nh ch·ªçn th√†nh c√¥ng!");
                        }
                    });
                });

                document.querySelectorAll('.delete-challenge-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToDelete = parseInt(e.currentTarget.dataset.id);
                        const challengeIndex = proposedChallenges.findIndex(c => c.id === idToDelete);
                        if (challengeIndex !== -1) {
                            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a th·ª≠ th√°ch n√†y kh√¥ng?")) {
                                proposedChallenges.splice(challengeIndex, 1);
                                saveChallenges();
                                renderProposedChallenges();
                                showNotification("Th·ª≠ th√°ch ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!");
                            }
                        }
                    });
                });

                document.querySelectorAll('.edit-challenge-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToEdit = parseInt(e.currentTarget.dataset.id);
                        const challengeToEdit = proposedChallenges.find(c => c.id === idToEdit);
                        if (challengeToEdit) {
                            const newText = prompt("Ch·ªânh s·ª≠a n·ªôi dung th·ª≠ th√°ch:", challengeToEdit.text);
                            if (newText !== null && newText.trim() !== '') {
                                challengeToEdit.text = newText;
                                saveChallenges();
                                renderProposedChallenges();
                                showNotification("Th·ª≠ th√°ch ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!");
                            }
                        }
                    });
                });
            }


            function renderPosts(filteredPosts = posts) {
                postsContainer.innerHTML = '';
                filteredPosts.forEach((post) => {
                    const postElement = document.createElement('div');
                    postElement.classList.add('post-item');

                    const postHeader = document.createElement('div');
                    postHeader.classList.add('post-header');
                    postHeader.innerHTML = `<h4>${post.author}</h4>`;
                    
                    let mediaHtml = '';
                    if (post.fileType && post.fileUrl) {
                        if (post.fileType.startsWith('image')) {
                            mediaHtml = `<img src="${post.fileUrl}" alt="${post.text}">`;
                        } else if (post.fileType.startsWith('video')) {
                            mediaHtml = `<video controls src="${post.fileUrl}"></video>`;
                        } else if (post.fileType.startsWith('audio')) {
                            mediaHtml = `<audio controls src="${post.fileUrl}"></audio>`;
                        }
                    }
                    
                    if (mediaHtml) {
                        postElement.appendChild(document.createRange().createContextualFragment(mediaHtml));
                    }

                    if (post.text) {
                        const textElement = document.createElement('p');
                        textElement.innerText = post.text;
                        postElement.appendChild(textElement);
                    }
                    
                    const actionsElement = document.createElement('div');
                    actionsElement.classList.add('actions');

                    let manageBtnsHtml = '';
                    if (currentUser && (post.author === currentUser || currentUser === ADMIN_USER)) {
                        manageBtnsHtml = `
                            <button class="edit-btn" data-id="${post.id}">S·ª≠a</button>
                            <button class="delete-btn" data-id="${post.id}">X√≥a</button>
                        `;
                    } else if (currentUser === ADMIN_USER) {
                            manageBtnsHtml = `<button class="delete-btn" data-id="${post.id}">X√≥a</button>`;
                    }
                    
                    actionsElement.innerHTML = `
                        <button class="like-btn" data-id="${post.id}">‚ù§Ô∏è <span class="like-count">${post.likes || 0}</span></button>
                        <input type="text" class="comment-input" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." data-id="${post.id}">
                        ${manageBtnsHtml}
                    `;
                    
                    postElement.appendChild(postHeader);
                    postElement.appendChild(actionsElement);
                    
                    if (post.comments && post.comments.length > 0) {
                        const commentsContainer = document.createElement('div');
                        commentsContainer.classList.add('comments-container');
                        post.comments.forEach((comment, commentIndex) => {
                            const commentElement = document.createElement('p');
                            commentElement.classList.add('comment');

                            let commentManageBtnsHtml = '';
                            if (currentUser && (comment.author === currentUser || currentUser === ADMIN_USER)) {
                                commentManageBtnsHtml = `
                                    <button class="edit-comment-btn" data-post-id="${post.id}" data-comment-index="${commentIndex}">S·ª≠a</button>
                                    <button class="delete-comment-btn" data-post-id="${post.id}" data-comment-index="${commentIndex}">X√≥a</button>
                                `;
                            }

                            commentElement.innerHTML = `
                                <strong>${comment.author}</strong>: <span>${comment.text}</span>
                                <span class="comment-actions">
                                    <button class="like-comment-btn" data-post-id="${post.id}" data-comment-index="${commentIndex}">‚ù§Ô∏è <span class="like-count">${comment.likes || 0}</span></button>
                                    ${commentManageBtnsHtml}
                                </span>
                            `;
                            commentsContainer.appendChild(commentElement);
                        });
                        postElement.appendChild(commentsContainer);
                    }

                    postsContainer.appendChild(postElement);
                });
                
                addEventListenersToPosts();
            }

            function addEventListenersToPosts() {
                const likeButtons = document.querySelectorAll('.like-btn');
                likeButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        const post = posts.find(p => p.id === id);
                        if (post) {
                            post.likes = (post.likes || 0) + 1;
                            updateUserPoints(post.author, 5);
                            savePosts();
                            renderPosts();
                            renderTopPosts();
                            renderLeaderboard();
                        }
                    });
                });

                const commentInputs = document.querySelectorAll('.comment-input');
                commentInputs.forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && currentUser) {
                            const id = e.currentTarget.dataset.id;
                            const commentText = e.currentTarget.value;
                            const post = posts.find(p => p.id === id);
                            if (commentText.trim() !== '' && post) {
                                if (!post.comments) {
                                    post.comments = [];
                                }
                                const newComment = {text: commentText, likes: 0, author: currentUser};
                                post.comments.push(newComment);
                                updateUserPoints(currentUser, 2);
                                savePosts();
                                renderPosts();
                                renderLeaderboard();
                            }
                        } else if (e.key === 'Enter' && !currentUser) {
                            alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ b√¨nh lu·∫≠n!");
                        }
                    });
                });
                
                const deleteButtons = document.querySelectorAll('.delete-btn');
                deleteButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToDelete = e.currentTarget.dataset.id;
                        const postIndex = posts.findIndex(p => p.id === idToDelete);
                        if (postIndex !== -1 && (posts[postIndex].author === currentUser || currentUser === ADMIN_USER)) {
                            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i vi·∫øt n√†y kh√¥ng?")) {
                                posts.splice(postIndex, 1);
                                savePosts();
                                renderPosts();
                                renderTopPosts();
                                renderLeaderboard();
                            }
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a b√†i vi·∫øt n√†y!");
                        }
                    });
                });

                const editButtons = document.querySelectorAll('.edit-btn');
                editButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToEdit = e.currentTarget.dataset.id;
                        const postToEdit = posts.find(p => p.id === idToEdit);
                        if (postToEdit && (postToEdit.author === currentUser || currentUser === ADMIN_USER)) {
                            const newText = prompt("Ch·ªânh s·ª≠a n·ªôi dung b√†i vi·∫øt:", postToEdit.text);
                            if (newText !== null && newText.trim() !== '') {
                                postToEdit.text = newText;
                                savePosts();
                                renderPosts();
                                renderTopPosts();
                            }
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠a b√†i vi·∫øt n√†y!");
                        }
                    });
                });

                const deleteCommentButtons = document.querySelectorAll('.delete-comment-btn');
                deleteCommentButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.postId;
                        const commentIndex = parseInt(e.currentTarget.dataset.commentIndex);
                        const post = posts.find(p => p.id === postId);

                        if (post && (post.comments[commentIndex].author === currentUser || currentUser === ADMIN_USER)) {
                            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√¨nh lu·∫≠n n√†y kh√¥ng?")) {
                                post.comments.splice(commentIndex, 1);
                                savePosts();
                                renderPosts();
                                renderLeaderboard();
                            }
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a b√¨nh lu·∫≠n n√†y!");
                        }
                    });
                });

                const editCommentButtons = document.querySelectorAll('.edit-comment-btn');
                editCommentButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.postId;
                        const commentIndex = parseInt(e.currentTarget.dataset.commentIndex);
                        const post = posts.find(p => p.id === postId);

                        if (post && (post.comments[commentIndex].author === currentUser || currentUser === ADMIN_USER)) {
                            const newCommentText = prompt("Ch·ªânh s·ª≠a b√¨nh lu·∫≠n:", post.comments[commentIndex].text);
                            if (newCommentText !== null && newCommentText.trim() !== '') {
                                post.comments[commentIndex].text = newCommentText;
                                savePosts();
                                renderPosts();
                            }
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠a b√¨nh lu·∫≠n n√†y!");
                        }
                    });
                });
            }

            function renderTopPosts() {
                topPostsContainer.innerHTML = '';
                const sortedPosts = [...posts].sort((a, b) => (b.likes || 0) - (a.likes || 0));
                const top1Posts = sortedPosts.slice(0, 1);

                top1Posts.forEach((post) => {
                    const postElement = document.createElement('div');
                    postElement.classList.add('post-item', 'top-post-item');

                    const postHeader = document.createElement('div');
                    postHeader.classList.add('post-header');
                    postHeader.innerHTML = `<h4>${post.author}</h4>`;
                    
                    let mediaHtml = '';
                    if (post.fileType && post.fileUrl) {
                        if (post.fileType.startsWith('image')) {
                            mediaHtml = `<img src="${post.fileUrl}" alt="${post.text}">`;
                        } else if (post.fileType.startsWith('video')) {
                            mediaHtml = `<video controls src="${post.fileUrl}"></video>`;
                        } else if (post.fileType.startsWith('audio')) {
                            mediaHtml = `<audio controls src="${post.fileUrl}"></audio>`;
                        }
                    }

                    if (mediaHtml) {
                        postElement.appendChild(document.createRange().createContextualFragment(mediaHtml));
                    }
                    
                    if (post.text) {
                        const textElement = document.createElement('p');
                        textElement.innerText = post.text;
                        postElement.appendChild(textElement);
                    }
                    
                    const likesElement = document.createElement('p');
                    likesElement.classList.add('top-likes');
                    likesElement.innerText = `‚ù§Ô∏è ${post.likes || 0} l∆∞·ª£t th√≠ch`;
                    
                    postElement.appendChild(postHeader);
                    postElement.appendChild(likesElement);

                    topPostsContainer.appendChild(postElement);
                });
            }

            function renderLeaderboard() {
                leaderboardContainer.innerHTML = '';
                
                const sortedUsers = Object.entries(userPoints)
                                        .sort(([,a],[,b]) => b - a)
                                        .slice(0, 10);

                if (sortedUsers.length > 0) {
                    const list = document.createElement('ol');
                    sortedUsers.forEach(([username, points], index) => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('leaderboard-item');
                        listItem.innerHTML = `
                            <span class="leaderboard-rank">${index + 1}.</span>
                            <span class="leaderboard-user">${username}</span>
                            <span class="leaderboard-points">${points} ƒëi·ªÉm</span>
                        `;
                        list.appendChild(listItem);
                    });
                    leaderboardContainer.appendChild(list);
                } else {
                    leaderboardContainer.innerHTML = '<p>Ch∆∞a c√≥ ai ghi ƒëi·ªÉm. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>';
                }
            }
            
            const contactForm = document.getElementById('contactForm');
            
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('name').value;
                    const email = document.getElementById('email').value;
                    const message = document.getElementById('message').value;
    
                    alert("C·∫£m ∆°n b·∫°n ƒë√£ li√™n h·ªá! Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ.");
                    contactForm.reset();
                });
            }

            updateUIForUser(currentUser);
            renderTopPosts();
            renderLeaderboard();
            renderProposedChallenges();
        });
    </script>
</body>
</html>