<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√°c T√°c Ph·∫©m C·ªßa C·ªông ƒê·ªìng</title>

    <link rel="stylesheet" href="cactacphamcongdong.css">
    <link href="[https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght=400;700&display=swap](https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght=400;700&display=swap)" rel="stylesheet">
</head>
<body>

    <header>
        <h1>C√°c T√°c Ph·∫©m C·ªßa C·ªông ƒê·ªìng</h1>
    </header>

    <main>
        <section id="hall-of-fame">
            <h2>üèÜ B·∫£ng v√†ng S√°ng t·∫°o</h2>
            <div id="top-posts-container" class="grid-container">
                <!-- Top post s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
            </div>
        </section>

        <section id="community-feed">
            <h2>C√°c t√°c ph·∫©m c·ªßa c·ªông ƒë·ªìng</h2>
            <div id="posts-container" class="grid-container">
                <!-- C√°c t√°c ph·∫©m kh√°c s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
            </div>
        </section>
        
        <div id="upload-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>G·ª≠i t√°c ph·∫©m c·ªßa b·∫°n</h2>
                <form id="upload-form">
                    <input type="text" id="post-title" placeholder="Ti√™u ƒë·ªÅ t√°c ph·∫©m c·ªßa b·∫°n" required>
                    <input type="hidden" id="post-id">
                    <label for="post-file">Ch·ªçn file (·∫£nh, video, audio):</label>
                    <input type="file" id="post-file" accept="image/*,video/*,audio/*">
                    <button type="submit" id="submit-btn">ƒêƒÉng t√°c ph·∫©m</button>
                </form>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // L·∫•y c√°c ph·∫ßn t·ª≠ DOM c·∫ßn thi·∫øt
            const postsContainer = document.getElementById('posts-container');
            const topPostsContainer = document.getElementById('top-posts-container');
            const uploadFormModal = document.getElementById('upload-modal');
            const uploadForm = document.getElementById('upload-form');
            const postTitleInput = document.getElementById('post-title');
            const postIdInput = document.getElementById('post-id');
            const postFileInput = document.getElementById('post-file');
            const submitBtn = document.getElementById('submit-btn');
            const closeBtn = document.querySelector('#upload-modal .close-btn');

            // Gi·∫£ l·∫≠p ng∆∞·ªùi d√πng hi·ªán t·∫°i v√† admin
            let currentUser = localStorage.getItem('currentUser');
            const ADMIN_USER = 'Trung Kien';

            // D·ªØ li·ªáu m·∫´u ƒë√£ ƒë∆∞·ª£c th√™m l·∫°i
            let posts = JSON.parse(localStorage.getItem('creativePosts')) || [
                { 
                    id: '1', 
                    author: 'Nguy·ªÖn VƒÉn A', 
                    text: "T√°c ph·∫©m ƒë·∫ßu tay c·ªßa m√¨nh, r·∫•t mong nh·∫≠n ƒë∆∞·ª£c g√≥p √Ω t·ª´ m·ªçi ng∆∞·ªùi! ‚ù§Ô∏è", 
                    fileUrl: "[https://images.unsplash.com/photo-1549880153-f725a3a2a95c](https://images.unsplash.com/photo-1549880153-f725a3a2a95c)", 
                    fileType: 'image/jpeg', 
                    likes: 500, 
                    comments: [
                        { text: "R·∫•t ƒë·∫πp, phong c√°ch ƒë·ªôc ƒë√°o!", likes: 2, author: "Kh√°ch" }, 
                        { text: "√ù t∆∞·ªüng hay th·∫≠t! üëç", likes: 1, author: "Kh√°ch" }
                    ] 
                },
                { 
                    id: '2', 
                    author: 'Anh', 
                    text: "M·ªôt bu·ªïi chi·ªÅu ho√†ng h√¥n tƒ©nh l·∫∑ng. M·ªçi ng∆∞·ªùi c√≥ th√≠ch kh√¥ng ·∫°?", 
                    fileUrl: "[https://images.unsplash.com/photo-1579783902677-50c11100f723](https://images.unsplash.com/photo-1579783902677-50c11100f723)", 
                    fileType: 'image/jpeg', 
                    likes: 100, 
                    comments: [
                        { text: "B·ª©c ·∫£nh n√†y r·∫•t c√≥ chi·ªÅu s√¢u!", likes: 5, author: "Kh√°ch" }, 
                        { text: "Th√≠ch phong c√°ch n√†y qu√°. üòç", likes: 3, author: "Kh√°ch" }
                    ] 
                },
                { 
                    id: '3', 
                    author: 'Tr·∫ßn Th·ªã B', 
                    text: "T√°c ph·∫©m l·∫•y c·∫£m h·ª©ng t·ª´ v≈© tr·ª•, hy v·ªçng c√°c b·∫°n th√≠ch!", 
                    fileUrl: "[https://images.unsplash.com/photo-1596495679951-64d8a1c8b3e8](https://images.unsplash.com/photo-1596495679951-64d8a1c8b3e8)", 
                    fileType: 'image/jpeg', 
                    likes: 15, 
                    comments: [
                        { text: "Tuy·ªát v·ªùi! M√†u s·∫Øc v√† b·ªë c·ª•c ƒë·ªÅu ho√†n h·∫£o.", likes: 8, author: "Kh√°ch" }, 
                        { text: "Nh√¨n r·∫•t ngh·ªá thu·∫≠t!", likes: 4, author: "Kh√°ch" }
                    ] 
                }
            ];
            let userPoints = JSON.parse(localStorage.getItem('userPoints')) || {};
            
            // H√†m l∆∞u b√†i vi·∫øt v√†o localStorage
            function savePosts() {
                localStorage.setItem('creativePosts', JSON.stringify(posts));
            }
            
            // H√†m l∆∞u ƒëi·ªÉm ng∆∞·ªùi d√πng v√†o localStorage
            function saveUserPoints() {
                localStorage.setItem('userPoints', JSON.stringify(userPoints));
            }

            // H√†m c·∫≠p nh·∫≠t ƒëi·ªÉm cho ng∆∞·ªùi d√πng
            function updateUserPoints(username, pointsToAdd) {
                if (!userPoints[username]) {
                    userPoints[username] = 0;
                }
                userPoints[username] += pointsToAdd;
                saveUserPoints();
            }
            
            // H√†m render c√°c b√†i vi·∫øt l√™n trang
            function renderPosts() {
                postsContainer.innerHTML = ''; // X√≥a n·ªôi dung c≈©
                
                if (posts.length === 0) {
                    postsContainer.innerHTML = '<p style="text-align: center;">Ch∆∞a c√≥ t√°c ph·∫©m n√†o ƒë∆∞·ª£c ƒëƒÉng t·∫£i. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>';
                    return;
                }

                posts.forEach((post) => {
                    const postElement = document.createElement('div');
                    postElement.classList.add('post-item');

                    // X√°c ƒë·ªãnh lo·∫°i file ƒë·ªÉ hi·ªÉn th·ªã
                    let mediaHtml = '';
                    if (post.fileUrl && post.fileType) {
                        if (post.fileType.startsWith('image')) {
                            mediaHtml = `<img src="${post.fileUrl}" alt="${post.text}">`;
                        } else if (post.fileType.startsWith('video')) {
                            mediaHtml = `<video controls src="${post.fileUrl}"></video>`;
                        } else if (post.fileType.startsWith('audio')) {
                            mediaHtml = `<audio controls src="${post.fileUrl}"></audio>`;
                        }
                    }

                    // T·∫°o c·∫•u tr√∫c HTML cho m·ªói b√†i vi·∫øt
                    postElement.innerHTML = `
                        ${mediaHtml}
                        <div class="post-content">
                            <h4>${post.author}</h4>
                            <p>${post.text}</p>
                            <div class="actions">
                                <button class="like-btn" data-id="${post.id}">‚ù§Ô∏è <span class="like-count">${post.likes || 0}</span></button>
                                ${currentUser && (post.author === currentUser || currentUser === ADMIN_USER) ? 
                                    `<button class="edit-btn" data-id="${post.id}">S·ª≠a</button>
                                     <button class="delete-btn" data-id="${post.id}">X√≥a</button>` : ''}
                            </div>
                            <input type="text" class="comment-input" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." data-id="${post.id}">
                            <div class="comments-container">
                                ${post.comments && post.comments.length > 0 ? 
                                    post.comments.map((comment, index) => `
                                        <div class="comment">
                                            <strong>${comment.author}</strong>: <span>${comment.text}</span>
                                            <span class="comment-actions">
                                                <button class="like-comment-btn" data-post-id="${post.id}" data-comment-index="${index}">‚ù§Ô∏è <span class="like-count">${comment.likes || 0}</span></button>
                                                ${currentUser && (comment.author === currentUser || currentUser === ADMIN_USER) ? 
                                                    `<button class="edit-comment-btn" data-post-id="${post.id}" data-comment-index="${index}">S·ª≠a</button>
                                                     <button class="delete-comment-btn" data-post-id="${post.id}" data-comment-index="${index}">X√≥a</button>` : ''}
                                            </span>
                                        </div>
                                    `).join('')
                                : ''}
                            </div>
                        </div>
                    `;

                    postsContainer.appendChild(postElement);
                });
                
                // G·∫Øn l·∫°i c√°c s·ª± ki·ªán sau khi render
                attachEventListeners();
            }

            // H√†m render c√°c b√†i vi·∫øt top
            function renderTopPosts() {
                topPostsContainer.innerHTML = '';
                const sortedPosts = [...posts].sort((a, b) => (b.likes || 0) - (a.likes || 0));
                const topPost = sortedPosts[0];

                if (topPost) {
                    const postElement = document.createElement('div');
                    postElement.classList.add('post-item', 'top-post-item');
                    let mediaHtml = '';
                    if (topPost.fileUrl && topPost.fileType) {
                        if (topPost.fileType.startsWith('image')) {
                            mediaHtml = `<img src="${topPost.fileUrl}" alt="${topPost.text}">`;
                        } else if (topPost.fileType.startsWith('video')) {
                            mediaHtml = `<video controls src="${topPost.fileUrl}"></video>`;
                        } else if (topPost.fileType.startsWith('audio')) {
                            mediaHtml = `<audio controls src="${topPost.fileUrl}"></audio>`;
                        }
                    }
                    postElement.innerHTML = `
                        ${mediaHtml}
                        <div class="post-content">
                            <h4>${topPost.author}</h4>
                            <p>${topPost.text}</p>
                            <p class="top-likes">‚ù§Ô∏è ${topPost.likes || 0} l∆∞·ª£t th√≠ch</p>
                        </div>
                    `;
                    topPostsContainer.appendChild(postElement);
                } else {
                    topPostsContainer.innerHTML = '<p style="text-align: center;">Ch∆∞a c√≥ t√°c ph·∫©m n√†o.</p>';
                }
            }

            // H√†m g·∫Øn c√°c s·ª± ki·ªán v√†o c√°c n√∫t v√† input
            function attachEventListeners() {
                // S·ª± ki·ªán cho n√∫t Like b√†i vi·∫øt
                document.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        const post = posts.find(p => p.id === id);
                        if (post) {
                            post.likes = (post.likes || 0) + 1;
                            updateUserPoints(post.author, 5);
                            savePosts();
                            renderPosts();
                            renderTopPosts();
                        }
                    });
                });

                // S·ª± ki·ªán cho input b√¨nh lu·∫≠n (khi nh·∫•n Enter)
                document.querySelectorAll('.comment-input').forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            if (!currentUser) {
                                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ b√¨nh lu·∫≠n!");
                                return;
                            }
                            const id = e.currentTarget.dataset.id;
                            const commentText = e.currentTarget.value;
                            const post = posts.find(p => p.id === id);
                            if (commentText.trim() !== '' && post) {
                                if (!post.comments) {
                                    post.comments = [];
                                }
                                const newComment = {text: commentText, likes: 0, author: currentUser};
                                post.comments.push(newComment);
                                updateUserPoints(currentUser, 2);
                                savePosts();
                                renderPosts();
                                renderTopPosts();
                            }
                        }
                    });
                });

                // S·ª± ki·ªán cho n√∫t X√≥a b√†i vi·∫øt
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToDelete = e.currentTarget.dataset.id;
                        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√°c ph·∫©m n√†y?")) {
                            const postIndex = posts.findIndex(p => p.id === idToDelete);
                            if (postIndex !== -1 && (posts[postIndex].author === currentUser || currentUser === ADMIN_USER)) {
                                posts.splice(postIndex, 1);
                                savePosts();
                                renderPosts();
                                renderTopPosts();
                            } else if (!currentUser) {
                                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ x√≥a!");
                            } else {
                                alert("B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a t√°c ph·∫©m n√†y!");
                            }
                        }
                    });
                });

                // S·ª± ki·ªán cho n√∫t S·ª≠a b√†i vi·∫øt
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const idToEdit = e.currentTarget.dataset.id;
                        const postToEdit = posts.find(p => p.id === idToEdit);
                        if (postToEdit && (postToEdit.author === currentUser || currentUser === ADMIN_USER)) {
                            postTitleInput.value = postToEdit.text;
                            postIdInput.value = postToEdit.id;
                            submitBtn.innerText = 'C·∫≠p nh·∫≠t';
                            uploadFormModal.style.display = 'block';
                        } else if (!currentUser) {
                            alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠a!");
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠a t√°c ph·∫©m n√†y!");
                        }
                    });
                });
                
                // S·ª± ki·ªán cho n√∫t Like b√¨nh lu·∫≠n
                document.querySelectorAll('.like-comment-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.postId;
                        const commentIndex = e.currentTarget.dataset.commentIndex;
                        const post = posts.find(p => p.id === postId);
                        if (post && post.comments[commentIndex]) {
                            post.comments[commentIndex].likes = (post.comments[commentIndex].likes || 0) + 1;
                            savePosts();
                            renderPosts();
                            renderTopPosts();
                        }
                    });
                });

                // S·ª± ki·ªán cho n√∫t X√≥a b√¨nh lu·∫≠n
                document.querySelectorAll('.delete-comment-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.postId;
                        const commentIndex = e.currentTarget.dataset.commentIndex;
                        const post = posts.find(p => p.id === postId);
                        if (post && (post.comments[commentIndex].author === currentUser || currentUser === ADMIN_USER)) {
                             if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√¨nh lu·∫≠n n√†y?")) {
                                post.comments.splice(commentIndex, 1);
                                savePosts();
                                renderPosts();
                                renderTopPosts();
                             }
                        } else if (!currentUser) {
                            alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ x√≥a b√¨nh lu·∫≠n!");
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a b√¨nh lu·∫≠n n√†y!");
                        }
                    });
                });
                
                // S·ª± ki·ªán cho n√∫t S·ª≠a b√¨nh lu·∫≠n
                document.querySelectorAll('.edit-comment-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.postId;
                        const commentIndex = e.currentTarget.dataset.commentIndex;
                        const post = posts.find(p => p.id === postId);
                        if (post && (post.comments[commentIndex].author === currentUser || currentUser === ADMIN_USER)) {
                            const newCommentText = prompt("Ch·ªânh s·ª≠a b√¨nh lu·∫≠n:", post.comments[commentIndex].text);
                            if (newCommentText !== null && newCommentText.trim() !== '') {
                                post.comments[commentIndex].text = newCommentText;
                                savePosts();
                                renderPosts();
                                renderTopPosts();
                            }
                        } else if (!currentUser) {
                            alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠a b√¨nh lu·∫≠n!");
                        } else {
                            alert("B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠a b√¨nh lu·∫≠n n√†y!");
                        }
                    });
                });
            }

            // X·ª≠ l√Ω form upload
            uploadForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const postId = postIdInput.value;
                const postTitle = postTitleInput.value;
                const postFile = postFileInput.files[0];

                if (!postTitle && !postFile) {
                    alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ ho·∫∑c ch·ªçn m·ªôt file!");
                    return;
                }
                
                // C·∫≠p nh·∫≠t gi·ªõi h·∫°n dung l∆∞·ª£ng file l√™n 1GB
                const maxFileSize = 1024 * 1024 * 1024;
                if (postFile && postFile.size > maxFileSize) {
                    alert("K√≠ch th∆∞·ªõc file qu√° l·ªõn! Vui l√≤ng ch·ªçn file c√≥ dung l∆∞·ª£ng d∆∞·ªõi 1GB.");
                    return;
                }
                
                if (!currentUser) {
                    alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i t√°c ph·∫©m!");
                    return;
                }

                const createOrUpdatePost = (fileUrl = null, fileType = null) => {
                    if (postId) {
                        // C·∫≠p nh·∫≠t b√†i vi·∫øt
                        const postToUpdate = posts.find(p => p.id === postId);
                        if (postToUpdate) {
                            postToUpdate.text = postTitle;
                            postToUpdate.fileUrl = fileUrl || postToUpdate.fileUrl;
                            postToUpdate.fileType = fileType || postToUpdate.fileType;
                            if (!fileUrl) { // X√≥a file n·∫øu kh√¥ng c√≥ file m·ªõi
                                postToUpdate.fileUrl = null;
                                postToUpdate.fileType = null;
                            }
                            savePosts();
                        }
                    } else {
                        // T·∫°o b√†i vi·∫øt m·ªõi
                        const newPost = {
                            id: Date.now().toString(),
                            author: currentUser,
                            text: postTitle,
                            fileUrl: fileUrl,
                            fileType: fileType,
                            likes: 0,
                            comments: []
                        };
                        posts.unshift(newPost);
                        updateUserPoints(currentUser, 10);
                        savePosts();
                    }
                    
                    renderPosts();
                    renderTopPosts();
                    uploadFormModal.style.display = "none";
                    uploadForm.reset();
                    submitBtn.innerText = 'ƒêƒÉng t√°c ph·∫©m';
                };

                if (postFile) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        createOrUpdatePost(reader.result, postFile.type);
                    };
                    reader.readAsDataURL(postFile);
                } else {
                    createOrUpdatePost();
                }
            });

            // S·ª± ki·ªán ƒë√≥ng modal
            closeBtn.addEventListener('click', () => {
                uploadFormModal.style.display = 'none';
                uploadForm.reset();
                submitBtn.innerText = 'ƒêƒÉng t√°c ph·∫©m';
                postIdInput.value = '';
            });

            window.addEventListener('click', (e) => {
                if (e.target === uploadFormModal) {
                    uploadFormModal.style.display = 'none';
                    uploadForm.reset();
                    submitBtn.innerText = 'ƒêƒÉng t√°c ph·∫©m';
                    postIdInput.value = '';
                }
            });

            // G·ªçi c√°c h√†m render l·∫ßn ƒë·∫ßu ƒë·ªÉ hi·ªÉn th·ªã d·ªØ li·ªáu
            renderPosts();
            renderTopPosts();
        });
    </script>
</body>
</html>

